package database

import (
	"github.com/flashbots/boost-relay/common"
)

var tableBase = common.GetEnv("DB_TABLE_PREFIX", "dev")
var TableEvent = tableBase + "_event"
var TableValidatorRegistration = tableBase + "_validator_registration"

var schema = `CREATE TABLE IF NOT EXISTS ` + TableEvent + ` (
	id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	inserted_at timestamp NOT NULL default current_timestamp,

	slot       bigint NOT NULL,
	epoch      bigint NOT NULL,
	event_type varchar(255) NOT NULL,
	event_data jsonb NOT NULL
);

CREATE TABLE IF NOT EXISTS ` + TableValidatorRegistration + ` (
	id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	inserted_at timestamp NOT NULL default current_timestamp,

	pubkey varchar(98) NOT NULL,
	registration jsonb NOT NULL,
	registration_timestamp timestamp NOT NULL,

	UNIQUE (pubkey, registration_timestamp)
);
`
